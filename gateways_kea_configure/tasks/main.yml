# Configure ISC KEA
---


- name: Include passwords.yml for postgresql password
  include_vars:
    file: passwords.yml

- name: check whether isc-dhcp-server.service exists
  shell: "systemctl status isc-dhcp-server"
  register: _isc_dhcp_status
  failed_when:  _isc_dhcp_status.rc != 0 and ("not-found" not in _isc_dhcp_status.stdout)
  changed_when: False
  check_mode: no

- name: stop isc-dhcp
  service: name=isc-dhcp-server state=stopped
  when: _isc_dhcp_status.rc == 0

- name: disable isc-dhcp
  service: name=isc-dhcp-server enabled=no
  when: _isc_dhcp_status.rc == 0

- name: enable kea-dhcp4
  service: name=kea-dhcp4 enabled=yes

- name: create /etc/kea/kea.conf
  template: src=keav4.conf.j2 dest=/etc/kea/kea.conf
  notify:
    - restart kea-dhcp4